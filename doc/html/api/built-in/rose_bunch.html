



<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>rose_bunch &mdash; Rose Documentation 2018.02.0-312-g3cbcacce documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/css/rtd-theme-fix.css" type="text/css" />
  
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="Rose Documentation 2018.02.0-312-g3cbcacce documentation" href="../../index.html"/>
        <link rel="up" title="Rose Built-In Applications" href="../rose-built-in-applications.html"/>
        <link rel="next" title="rose_prune" href="rose_prune.html"/>
        <link rel="prev" title="rose_arch" href="rose_arch.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> Rose Documentation
          

          
          </a>

          
            
            
              <div class="version">
                2018.02.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">User Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/cylc/index.html">Cylc Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial/rose/index.html">Rose Tutorial</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cheat-sheet.html">Cheat Sheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
</ul>
<p class="caption"><span class="caption-text">Rose API Reference</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../command-reference.html">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../configuration.html">Rose Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../environment-variables.html">Rose Environment Variables</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rose-bash-library.html">Rose Bash Library</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../rose-built-in-applications.html">Rose Built-In Applications</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="fcm_make.html"><code class="docutils literal notranslate"><span class="pre">fcm_make</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="rose_ana.html"><code class="docutils literal notranslate"><span class="pre">rose_ana</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="rose_arch.html"><code class="docutils literal notranslate"><span class="pre">rose_arch</span></code></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#"><code class="docutils literal notranslate"><span class="pre">rose_bunch</span></code></a><ul>
<li class="toctree-l3"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration">Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="rose_prune.html"><code class="docutils literal notranslate"><span class="pre">rose_prune</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../rose-gtk-library.html">Rose GTK library</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rose-macro.html">Rose Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rose-upgrader-macros.html">Rose Upgrade Macro API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../rosie-web.html">Rosie Web API</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../terms.html">Rose Terms Of Use</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Rose Documentation</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../rose-built-in-applications.html">Rose Built-In Applications</a> &raquo;</li>
        
      <li><code class="docutils literal notranslate"><span class="pre">rose_bunch</span></code></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="rose-bunch">
<h1><code class="docutils literal notranslate"><span class="pre">rose_bunch</span></code><a class="headerlink" href="#rose-bunch" title="Permalink to this headline">¶</a></h1>
<p>For the running of multiple command variants in parallel under a single
job, as defined by the application configuration.</p>
<p>Each variant of the command is run in the same working directory with
its output directed to separate <code class="docutils literal notranslate"><span class="pre">.out</span></code> and <code class="docutils literal notranslate"><span class="pre">.err</span></code> files of the form:</p>
<div class="highlight-sub notranslate"><div class="highlight"><pre><span></span>bunch.<span class="s">&lt;name&gt;</span>.out
</pre></div>
</div>
<p>Should you need separate working directories you should configure your
command to create the appropriate subdirectory for working in.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Under load balancing systems such as PBS or Slurm, you will need to
set resource requests to reflect the resources required by running
multiple commands at once e.g. if one command would require 1GB
memory and you have configured your app to run up to four commands at
once then you will need to request 4GB of memory.</p>
</div>
<div class="section" id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h2>
<div class="highlight-rose notranslate"><div class="highlight"><pre><span></span><span class="nv">meta</span><span class="o">=</span><span class="s">rose_bunch</span>
<span class="nv">mode</span><span class="o">=</span><span class="s">rose_bunch</span>

<span class="nt">[bunch]</span>
<span class="nv">command-format</span><span class="o">=</span><span class="s">echo arg1: %(arg1)s, arg2: %(arg2)s, command-instance: %(command-instances)s</span>
<span class="nv">command-instances </span><span class="o">=</span> <span class="s">4</span>
<span class="nv">fail-handle </span><span class="o">=</span> <span class="s">abort</span>
<span class="nv">incremental </span><span class="o">=</span> <span class="s">True</span>
<span class="nv">names </span><span class="o">=</span> <span class="s">foo1 bar2 baz3 qux4</span>
<span class="nv">pool-size</span><span class="o">=</span><span class="s">2</span>

<span class="nt">[bunch-args]</span>
<span class="nv">arg1</span><span class="o">=</span><span class="s">1 2 3 4</span>
<span class="nv">arg2</span><span class="o">=</span><span class="s">foo bar baz qux</span>
</pre></div>
</div>
</div>
<div class="section" id="configuration">
<h2>Configuration<a class="headerlink" href="#configuration" title="Permalink to this headline">¶</a></h2>
<p>The application is normally configured in the
<a class="reference internal" href="#rose:conf:rose_bunch[bunch]" title="rose:conf:rose_bunch[bunch]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch]</span></code></a> and <a class="reference internal" href="#rose:conf:rose_bunch[bunch-args]" title="rose:conf:rose_bunch[bunch-args]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose_bunch[bunch-args]</span></code></a>
sections of the <a class="reference internal" href="../configuration/application.html#rose:file:rose-app.conf" title="rose:file:rose-app.conf"><code class="xref rose rose-file docutils literal notranslate"><span class="pre">rose-app.conf</span></code></a> file.</p>
<dl class="app">
<dt id="rose:app:rose_bunch">
<em class="property">Rose App </em><code class="descname">rose_bunch</code><a class="headerlink" href="#rose:app:rose_bunch" title="Permalink to this definition">¶</a></dt>
<dd><dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]">
<em class="property">Config </em><code class="descname">[bunch]</code><a class="headerlink" href="#rose:conf:rose_bunch[bunch]" title="Permalink to this definition">¶</a></dt>
<dd><dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]command-format">
<em class="property">Config </em><code class="descname">command-format</code><em class="property">= FORMAT</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]command-format" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Compulsory:</th><td class="field-body">True</td>
</tr>
</tbody>
</table>
<p>A Pythonic <code class="docutils literal notranslate"><span class="pre">printf</span></code>-style format string to construct the commands
to run. Insert placeholders <code class="docutils literal notranslate"><span class="pre">%(argname)s</span></code> for substitution of the
arguments specified under <a class="reference internal" href="#rose:conf:rose_bunch[bunch-args]" title="rose:conf:rose_bunch[bunch-args]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[bunch-args]</span></code></a> to the invoked
command. The placeholder <code class="docutils literal notranslate"><span class="pre">%(command-instances)s</span></code> is reserved for
inserting an automatically generated index for the command
invocation when using the command-instances setting.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]command-instances">
<em class="property">Config </em><code class="descname">command-instances</code><em class="property">= N</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]command-instances" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows the user to specify an integer value for the number of
instances of a command they want to run. This generates the values
used by the <code class="docutils literal notranslate"><span class="pre">%(command-instances)s</span></code> value in command-format.
Useful for cases where the only difference between invocations
would be an index number e.g. ensemble members. Note indexes
start at <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]pool-size">
<em class="property">Config </em><code class="descname">pool-size</code><em class="property">= N</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]pool-size" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows the user to limit the number of concurrently running commands.
If not specified then all command variations will be run at the same
time.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]fail-mode">
<em class="property">Config </em><code class="descname">fail-mode</code><em class="property">= continue|abort</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]fail-mode" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">continue</td>
</tr>
</tbody>
</table>
<p>Specify what action you want the job to take on the failure of a
command that it is trying to run. If set to continue all command
variants will be run by the job and the job will return a non-zero
exit code upon completion e.g. if three commands are to be run and
the second one fails, all three will be run and the job will exit
with a return code of <code class="docutils literal notranslate"><span class="pre">1</span></code>. Alternatively, if <a class="reference internal" href="#rose:conf:rose_bunch[bunch]fail-mode" title="rose:conf:rose_bunch[bunch]fail-mode"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">fail-mode</span></code></a>
is set to abort then on failure of any one of the command variants
it will stop trying to run any further variants N.B. the job will
wait for any already running commands to finish before exiting.
Commands that won’t be run due to aborting will be reported in the
job output with a <code class="docutils literal notranslate"><span class="pre">[SKIP]</span></code> prefix when running in verbose mode.
For example in the case of three command variants with a
<a class="reference internal" href="#rose:conf:rose_bunch[bunch]pool-size" title="rose:conf:rose_bunch[bunch]pool-size"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">pool-size</span></code></a> of <code class="docutils literal notranslate"><span class="pre">1</span></code> and <a class="reference internal" href="#rose:conf:rose_bunch[bunch]fail-mode" title="rose:conf:rose_bunch[bunch]fail-mode"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">fail-mode=abort</span></code></a>,
if the second variant failed then the job would exit with a
non-zero error code without having run the third variant.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]incremental">
<em class="property">Config </em><code class="descname">incremental</code><em class="property">= true|false</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]incremental" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Default:</th><td class="field-body">true</td>
</tr>
</tbody>
</table>
<p>If set to <code class="docutils literal notranslate"><span class="pre">true</span></code> then only failed commands will be re-run on
retrying running of the job. If any changes are made to the
configuration being run then all variants will be re-run. Similarly,
running the app with the <code class="docutils literal notranslate"><span class="pre">--new</span></code> option to
<a class="reference internal" href="../command-reference.html#command-rose-task-run"><span class="std std-ref">rose task-run</span></a>
will result in all commands being run. In verbose mode the app
will report commands that won’t be run due to previous successes
in the job output with a <code class="docutils literal notranslate"><span class="pre">[PASS]</span></code> prefix.</p>
</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch]names">
<em class="property">Config </em><code class="descname">names</code><em class="property">= name1 name2 ...</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch]names" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows defining names for each of the command variants to be run,
facilitating identification in logs. If not set then commands will
be identified by their index. The number of entries in the names
must be the same as the number of entries in each of the args to
be used.</p>
</dd></dl>

</dd></dl>

<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch-args]">
<em class="property">Config </em><code class="descname">[bunch-args]</code><a class="headerlink" href="#rose:conf:rose_bunch[bunch-args]" title="Permalink to this definition">¶</a></dt>
<dd><p>This section is used to specify the various combinations of args to be
passed to the <a class="reference internal" href="../configuration/application.html#rose:conf:rose-app.conf[command]" title="rose:conf:rose-app.conf[command]"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">rose-app.conf[command]</span></code></a> specified under
<a class="reference internal" href="#rose:conf:rose_bunch[bunch]command-format" title="rose:conf:rose_bunch[bunch]command-format"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[bunch]command-format</span></code></a>.</p>
<dl class="conf">
<dt id="rose:conf:rose_bunch[bunch-args]argname">
<em class="property">Config </em><code class="descname">argname</code><em class="property">= val1 val2 ...</em><a class="headerlink" href="#rose:conf:rose_bunch[bunch-args]argname" title="Permalink to this definition">¶</a></dt>
<dd><p>Allows defining named lists of argument values to pass to
<a class="reference internal" href="#rose:conf:rose_bunch[bunch]command-format" title="rose:conf:rose_bunch[bunch]command-format"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[bunch]command-format</span></code></a>. Multiple named sets of
arguments can be defined. Each argname can be referenced in the
using <code class="docutils literal notranslate"><span class="pre">%(argname)s</span></code>. The only disallowed name is
<code class="docutils literal notranslate"><span class="pre">command-instances</span></code>, which is reserved for the
auto-generated list of instances when the
<a class="reference internal" href="#rose:conf:rose_bunch[bunch]command-instances" title="rose:conf:rose_bunch[bunch]command-instances"><code class="xref rose rose-conf docutils literal notranslate"><span class="pre">[bunch]command-instances=N</span></code></a> option is used.</p>
</dd></dl>

</dd></dl>

</dd></dl>

</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rose_prune.html" class="btn btn-neutral float-right" title="rose_prune" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="rose_arch.html" class="btn btn-neutral" title="rose_arch" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright : British Crown Copyright 2012-8 Met Office. See Terms of Use. This document is released under the Open Government Licence.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'2018.02.0-312-g3cbcacce',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../_static/js/minicylc.js"></script>
      <script type="text/javascript" src="../../_static/js/spoiler.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script type="text/javascript" src="../../_static/js/rtd-theme-extensions.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>